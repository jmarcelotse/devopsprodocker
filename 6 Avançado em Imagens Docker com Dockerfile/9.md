# ENV no Dockerfile
A instru√ß√£o `ENV` no Dockerfile √© usada para definir **vari√°veis de ambiente** que ser√£o configuradas no cont√™iner durante sua execu√ß√£o. Essas vari√°veis podem ser usadas pelo sistema operacional do cont√™iner, pela aplica√ß√£o ou por comandos executados no Dockerfile.

# 1. Sintaxe do ENV

dockerfile
```
ENV chave valor
```
- `chave`: Nome da vari√°vel de ambiente.
- `valor`: Valor associado √† vari√°vel.

# 2. Por Que Usar ENV?
- **Flexibilidade**: Permite configurar par√¢metros que podem variar, como a porta do servidor ou credenciais.
- **Reutiliza√ß√£o**: Valores definidos no ENV podem ser usados em v√°rias partes do Dockerfile.
- **Configura√ß√£o Din√¢mica**: Facilita ajustar o comportamento da imagem sem modific√°-la.

# 3. Exemplos de Uso
## 3.1 Definir uma Vari√°vel Simples

dockerfile
```
ENV APP_NAME minha-aplicacao
```
No cont√™iner, a vari√°vel `APP_NAME` estar√° dispon√≠vel:

bash
```
echo $APP_NAME
# Sa√≠da: minha-aplicacao
```
## 3.2 Vari√°veis para Configura√ß√£o da Aplica√ß√£o

dockerfile
```
ENV NODE_ENV production
ENV PORT 3000
```
Aqui:

- `NODE_ENV` √© usado para indicar o ambiente de execu√ß√£o da aplica√ß√£o.
- `PORT` define a porta padr√£o que a aplica√ß√£o ir√° escutar.

## 3.3 Usando Vari√°veis em Comandos do Dockerfile
As vari√°veis definidas com `ENV` podem ser referenciadas usando a sintaxe `$CHAVE` ou `${CHAVE}`.

dockerfile
```
ENV APP_DIR /usr/src/app
WORKDIR $APP_DIR
COPY . $APP_DIR
```
Aqui:

- O diret√≥rio de trabalho (`WORKDIR`) e o destino da c√≥pia (`COPY`) utilizam o valor da vari√°vel `APP_DIR`.

## 3.4 Usando Vari√°veis em Scripts
As vari√°veis definidas no `ENV` tamb√©m est√£o dispon√≠veis para comandos executados no cont√™iner.

dockerfile
```
ENV GREETING "Ol√°, mundo!"
CMD ["bash", "-c", "echo $GREETING"]
```
Ao executar o cont√™iner:

bash
```
docker run minha-imagem
# Sa√≠da: Ol√°, mundo!
```
# 4. Sobrescrevendo Vari√°veis com `docker run`
As vari√°veis definidas no Dockerfile podem ser sobrescritas no momento da execu√ß√£o do cont√™iner usando a flag `-e`.

## Exemplo:

dockerfile
```
ENV GREETING "Ol√°, mundo!"
CMD ["bash", "-c", "echo $GREETING"]
```
Execute o cont√™iner com uma vari√°vel diferente:

bash
```
docker run -e GREETING="Ol√°, Docker!" minha-imagem
# Sa√≠da: Ol√°, Docker!
```
# 5. Definindo V√°rios Valores com uma √önica Instru√ß√£o
√â poss√≠vel definir v√°rias vari√°veis de ambiente em uma √∫nica instru√ß√£o `ENV`.

## Exemplo:
dockerfile
```
ENV NODE_ENV=production PORT=3000 DEBUG=true
```

Isso cria:
- `NODE_ENV=production`
- `PORT=3000`
- `DEBUG=true`

# 6. Combinando ENV com ARG
A instru√ß√£o `ARG` define vari√°veis que podem ser usadas **durante o build**, enquanto o `ENV` define vari√°veis que estar√£o dispon√≠veis **no cont√™iner em tempo de execu√ß√£o**.

## Exemplo:

dockerfile
```
# Vari√°vel ARG para uso no build
ARG PORT=3000
# Usar o ARG para definir o ENV
ENV APP_PORT=$PORT
```
- Durante o build, voc√™ pode passar um valor para o `ARG:

bash
```
docker build --build-arg PORT=8080 -t minha-imagem .
```
- O valor ser√° usado para configurar o `ENV` no cont√™iner.

# 7. Usos Avan√ßados
## 7.1 Definir Defaults Sens√≠veis
Use `ENV` para definir valores padr√£o para vari√°veis sens√≠veis:

dockerfile
```
ENV DB_HOST=localhost DB_PORT=5432
```
## 7.2 Vari√°veis Dependentes
Voc√™ pode usar vari√°veis definidas anteriormente para configurar outras vari√°veis:

dockerfile
```
ENV APP_DIR=/usr/src/app
ENV LOG_DIR=$APP_DIR/logs
WORKDIR $LOG_DIR
```
# 8. Testando ENV no Cont√™iner
## Passo 1: Criar o Dockerfile

dockerfile
```
FROM ubuntu:20.04

ENV GREETING="Ol√°, mundo!" \
    NAME="Docker"

CMD ["bash", "-c", "echo $GREETING $NAME"]
```
## Passo 2: Construir a Imagem
bash
```
docker build -t teste-env .
```
## Passo 3: Executar o Cont√™iner
bash
```
docker run teste-env

# Sa√≠da: Ol√°, mundo! Docker
```
## Passo 4: Sobrescrever Vari√°veis
bash
```
docker run -e NAME="Mundo" teste-env
# Sa√≠da: Ol√°, mundo! Mundo
```
# 9. Boas Pr√°ticas com ENV
1. **Use ENV para Valores Que Variam**:
   - Como portas, modos de execu√ß√£o e configura√ß√µes de ambiente.

2. **Evite Armazenar Credenciais no Dockerfile**:
   - Em vez disso, use gerenciadores de segredos ou passe vari√°veis sens√≠veis no momento da execu√ß√£o:

bash
```
docker run -e DB_PASSWORD="senha-secreta" minha-imagem
```
3. **Combine com `.env` Files**:
   - Use arquivos `.env` para gerenciar configura√ß√µes fora do Dockerfile:

bash
```
docker run --env-file .env minha-imagem
```
4. **Documente as Vari√°veis no Dockerfile**:
   - Explique o prop√≥sito de cada vari√°vel para facilitar o entendimento e a manuten√ß√£o.

5. **Defina Valores Padr√£o**:
   - Sempre forne√ßa valores padr√£o para evitar comportamentos imprevis√≠veis:

dockerfile
```
ENV LOG_LEVEL=info
```
# 10. Conclus√£o
A instru√ß√£o `ENV` √© uma ferramenta poderosa no Dockerfile que permite configurar o comportamento do cont√™iner de forma flex√≠vel e reutiliz√°vel. Ela facilita a parametriza√ß√£o da imagem e melhora a gest√£o de configura√ß√µes no ambiente de execu√ß√£o.

## Resumo:
- **Definir Vari√°veis de Ambiente**: Simplifica configura√ß√µes e adapta√ß√µes.
- **Flexibilidade**: Vari√°veis podem ser sobrescritas no momento da execu√ß√£o.
- **Melhores Pr√°ticas**:
   - Evite armazenar segredos diretamente no Dockerfile.
    - Use valores padr√£o sempre que poss√≠vel.

Se precisar de mais exemplos ou ajuda com vari√°veis din√¢micas no Dockerfile, √© s√≥ chamar! üöÄüòä