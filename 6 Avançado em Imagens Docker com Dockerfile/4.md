# Possibilidades com Dockerfile
O **Dockerfile** oferece diversas possibilidades para personalizar, automatizar e otimizar a cria√ß√£o de imagens Docker. Ele √© extremamente flex√≠vel, permitindo construir desde ambientes simples at√© cen√°rios complexos com camadas otimizadas, multistage builds, vari√°veis de ambiente, volume, scripts personalizados e seguran√ßa aprimorada.

Neste guia, exploraremos **todas as possibilidades** que voc√™ pode alcan√ßar ao utilizar um **Dockerfile**.

# 1. Cria√ß√£o de Imagens Personalizadas
A principal fun√ß√£o do Dockerfile √© criar **imagens personalizadas**, permitindo definir exatamente o ambiente de execu√ß√£o necess√°rio para a aplica√ß√£o.

## Exemplo B√°sico:
dockerfile
```
FROM ubuntu:20.04
RUN apt-get update && apt-get install -y curl
CMD ["curl", "https://google.com"]
```
Aqui:
- A imagem base √© `ubuntu:20.04`.
- Pacotes s√£o instalados com o `RUN`.
- O comando padr√£o (`CMD`) usa o `curl`.

# 2. Configura√ß√£o de Vari√°veis de Ambiente
Voc√™ pode definir vari√°veis de ambiente usando a instru√ß√£o `ENV`. Isso permite flexibilizar a imagem e facilitar configura√ß√µes din√¢micas.

## Exemplo:

dockerfile
```
FROM node:16
WORKDIR /usr/src/app

# Definir vari√°veis de ambiente
ENV PORT=3000
ENV NODE_ENV=production

COPY package.json .
RUN npm install
COPY . .

EXPOSE $PORT
CMD ["node", "app.js"]
```
- **Uso**: A vari√°vel `PORT` pode ser usada no c√≥digo Node.js como `process.env.PORT`.

# 3. Instala√ß√£o de Pacotes e Depend√™ncias
O `RUN` √© utilizado para executar comandos durante a constru√ß√£o da imagem. Ele √© usado para instalar pacotes e depend√™ncias.

## Exemplo para Ubuntu:

dockerfile
```
RUN apt-get update && apt-get install -y \
    curl \
    git \
    vim
```
## Exemplo com Python:

dockerfile
```
FROM python:3.9
WORKDIR /app

# Instalar depend√™ncias do Python
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .
CMD ["python", "app.py"]
```
# 4. Copiando e Manipulando Arquivos
As instru√ß√µes `COPY` e `ADD` s√£o usadas para transferir arquivos do host para o cont√™iner.

# Diferen√ßa Entre `COPY` e `ADD`:
- `COPY`: Simplesmente copia arquivos.
- `ADD`: Copia e tamb√©m permite extrair arquivos compactados.

## Exemplo:

dockerfile
```
COPY app/ /usr/src/app/
ADD config.tar.gz /usr/src/config/
```
# 5. Defini√ß√£o de Diret√≥rio de Trabalho
A instru√ß√£o `WORKDIR` define o diret√≥rio de trabalho padr√£o dentro do cont√™iner.

## Exemplo:
dockerfile
```
FROM node:16
WORKDIR /usr/src/app
COPY . .
RUN npm install
CMD ["node", "server.js"]
```
- Todos os comandos a partir do `WORKDIR` usam esse diret√≥rio como refer√™ncia.

# 6. Exposi√ß√£o de Portas
A instru√ß√£o `EXPOSE` documenta quais portas o cont√™iner ir√° escutar.

## Exemplo:

dockerfile
```
EXPOSE 8080
```
- Isso **n√£o publica** a porta automaticamente, mas informa que o cont√™iner ir√° usar essa porta.
Para publicar a porta ao executar:

bash
```
docker run -p 8080:8080 minha-imagem
```
# 7. Uso de Comandos `CMD` e `ENTRYPOINT`
## Diferen√ßa Entre `CMD` e `ENTRYPOINT`:
- `CMD`: Define o comando padr√£o, mas pode ser sobrescrito no `docker run`.
- `ENTRYPOINT`: Define um comando fixo que √© executado sempre, mesmo que argumentos sejam passados.

## Exemplo com `CMD`:

dockerfile
```
CMD ["node", "app.js"]
```

## Exemplo com `ENTRYPOINT`:

dockerfile
```
ENTRYPOINT ["python"]
CMD ["app.py"]
```
Ao rodar:

bash
```
docker run minha-imagem outro-script.py
```
O `ENTRYPOINT` ser√° fixo (`python`) e o argumento (`outro-script.py`) ser√° passado.

# 8. Uso de Multistage Builds
Multistage builds permitem criar imagens **menores** ao separar a fase de constru√ß√£o da fase de execu√ß√£o. Isso √© √∫til em aplica√ß√µes que precisam compilar c√≥digo ou gerar arquivos antes de rodar.

## Exemplo:

dockerfile
```
# Etapa de Build
FROM node:16 AS build
WORKDIR /app
COPY package.json .
RUN npm install
COPY . .
RUN npm run build

# Etapa de Execu√ß√£o
FROM nginx:alpine
COPY --from=build /app/build /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```
Aqui:
- A primeira etapa (`build`) cria a aplica√ß√£o.
- A segunda etapa copia apenas os arquivos necess√°rios, deixando a imagem final muito menor.

# 9. Volumes e Persist√™ncia de Dados
Use a instru√ß√£o `VOLUME` para criar diret√≥rios persistentes no cont√™iner.

## Exemplo:

dockerfile
```
VOLUME /data
```
Ao rodar:

bash
```
docker run -v /host/data:/data minha-imagem
```
- Os dados dentro do diret√≥rio `/data` no cont√™iner ser√£o persistidos no diret√≥rio `/host/data do host`.

# 10. Executando Scripts Personalizados
Voc√™ pode copiar e executar scripts durante a constru√ß√£o ou ao iniciar o cont√™iner.

## Exemplo:

dockerfile
```
COPY setup.sh /usr/local/bin/setup.sh
RUN chmod +x /usr/local/bin/setup.sh
ENTRYPOINT ["/usr/local/bin/setup.sh"]
```
`setup.sh`:

bash
```
#!/bin/bash
echo "Inicializando o cont√™iner..."
exec "$@"
```
# 11. Adicionando Metadados √† Imagem
Use a instru√ß√£o `LABEL` para adicionar informa√ß√µes √∫teis √† imagem, como autor, descri√ß√£o ou vers√£o.

## Exemplo:

dockerfile
```
LABEL maintainer="seu-email@exemplo.com"
LABEL version="1.0.0"
LABEL description="Minha primeira imagem Docker"
```
Voc√™ pode visualizar os metadados com:

bash
```
docker inspect minha-imagem
```
# 12. Seguran√ßa no Dockerfile
- Use imagens base leves e seguras, como `alpine`.
- N√£o use `root` como usu√°rio:

dockerfile
```
RUN adduser -D myuser
USER myuser
```
- Evite armazenar segredos diretamente no Dockerfile.

# 13. Otimiza√ß√£o e Boas Pr√°ticas
1. **Ordem Importa**:
- Coloque instru√ß√µes que raramente mudam (como `RUN apt-get`) no in√≠cio para aproveitar o cache.

2. **Combine Comandos**:

dockerfile
```
RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*
```
3. **Reduza o Contexto**:
- Use o arquivo `.dockerignore` para evitar enviar arquivos desnecess√°rios:

bash
```
node_modules
.git
*.log
```

4. **Testar e Auditar Imagens**:
- Use scanners como `trivy` ou `docker scan` para verificar vulnerabilidades.

# Conclus√£o
O Dockerfile oferece uma ampla gama de possibilidades, permitindo desde a cria√ß√£o de imagens b√°sicas at√© cen√°rios complexos com multistage builds, configura√ß√£o din√¢mica, persist√™ncia de dados e otimiza√ß√£o de camadas.

Ao dominar o Dockerfile, voc√™ automatiza o provisionamento de ambientes de desenvolvimento, teste e produ√ß√£o de forma consistente e eficiente.

Se precisar de ajuda com alguma funcionalidade espec√≠fica ou um Dockerfile mais complexo, √© s√≥ pedir! üöÄ