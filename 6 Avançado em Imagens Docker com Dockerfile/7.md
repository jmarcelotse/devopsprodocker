# ADD no Dockerfile
A instru√ß√£o `ADD` no Dockerfile √© usada para copiar arquivos e diret√≥rios do ***host*** para o **sistema de arquivos do cont√™iner** durante o build da imagem. Embora semelhante √† instru√ß√£o `COPY`, o `ADD` possui funcionalidades adicionais que o diferenciam, como a capacidade de **extrair arquivos compactados** e **fazer o download de arquivos externos via URL**.

# 1. Sintaxe do ADD

dockerfile
```
ADD [op√ß√µes] <origem> <destino>
```
- `<origem>`: Caminho no host ou URL externa (se for um link HTTP/HTTPS).
- `<destino>`: Caminho dentro do cont√™iner.
- `[op√ß√µes]`: Pode incluir `--chown` para definir o dono do arquivo.

# 2. Funcionalidades do ADD
## 2.1 Copiar Arquivos Locais
O `ADD` pode copiar arquivos ou diret√≥rios do **build context** para o cont√™iner.

### Exemplo:

dockerfile
```
ADD app.js /usr/src/app/
```
Isso copia o arquivo `app.js` do diret√≥rio local para o diret√≥rio `/usr/src/app/` no cont√™iner.

## 2.2 Extrair Arquivos Compactados
Se o arquivo de origem for um **arquivo compactado** no formato `tar` (como `tar.gz`), o `ADD` o extrai automaticamente para o diret√≥rio de destino.

### Exemplo:

dockerfile
```
ADD config.tar.gz /usr/src/config/
```
Se `config.tar.gz` contiver:

arduino
```
config/
  file1.txt
  file2.txt
```
Ele ser√° extra√≠do para:

arduino
```
/usr/src/config/file1.txt
/usr/src/config/file2.txt
```
### Observa√ß√£o: A extra√ß√£o autom√°tica s√≥ funciona com arquivos `.tar`, `.tar.gz` e `.tar.bz2`. Outros formatos, como `.zip`, n√£o s√£o suportados.

## 2.3 Download de Arquivos Externos
O `ADD` pode baixar arquivos diretamente de URLs externas.

### Exemplo:

dockerfile
```
ADD https://example.com/config.json /usr/src/config.json
```
O arquivo `config.json` ser√° baixado do link e copiado para o diret√≥rio `/usr/src/` no cont√™iner.

# 3. Compara√ß√£o: `ADD` vs `COPY`
Embora o `ADD` seja mais poderoso, o `COPY` √© geralmente preferido porque √© mais expl√≠cito e previs√≠vel.

| Caracter√≠stica                | `COPY`             | `ADD`                                    |
| ----------------------------- | ------------------ | ---------------------------------------- |
| C√≥pia de arquivos locais      | Sim                | Sim                                      |
| Extra√ß√£o de arquivos `.tar`   | N√£o                | Sim                                      |
| Download de arquivos externos | N√£o                | Sim                                      |
| Recomenda√ß√£o                  | Para c√≥pia simples | Quando √© necess√°rio extra√ß√£o ou download |

## Melhor Pr√°tica:
- Use `COPY` sempre que poss√≠vel.
- Use `ADD` apenas quando precisar extrair arquivos compactados ou baixar conte√∫do externo.

# 4. Exemplos Pr√°ticos
## 4.1 Copiar um Arquivo Local

dockerfile
```
FROM ubuntu:20.04

# Copiar arquivo local para o cont√™iner
ADD index.html /usr/share/nginx/html/index.html
```
## 4.2 Extrair um Arquivo Compactado

dockerfile
```
FROM ubuntu:20.04

# Adicionar e extrair um arquivo compactado
ADD configs.tar.gz /usr/src/configs/
```
Se `configs.tar.gz` contiver:

```
configs/
  config1.yml
  config2.yml
```
O diret√≥rio resultante no cont√™iner ser√°:

bash
```
/usr/src/configs/config1.yml
/usr/src/configs/config2.yml
```
## 4.3 Baixar um Arquivo Externo

dockerfile
```
FROM ubuntu:20.04

# Baixar um arquivo JSON da internet
ADD https://jsonplaceholder.typicode.com/todos/1 /usr/src/todo.json

CMD ["cat", "/usr/src/todo.json"]
```
## Testando:
1. Construa a imagem:

bash
```
docker build -t add-example .
```
2. Execute o cont√™iner:

bash
```
docker run --rm add-example
```

### Sa√≠da Esperada:

json
```
{
  "userId": 1,
  "id": 1,
  "title": "delectus aut autem",
  "completed": false
}
```
## 4.4 Definindo Permiss√µes com --chown
O `ADD` permite definir o usu√°rio e grupo donos dos arquivos copiados:

### Exemplo:

dockerfile
```
FROM ubuntu:20.04

# Copiar arquivos com permiss√µes espec√≠ficas
ADD --chown=1000:1000 app/ /usr/src/app/
```
Aqui:

- O **UID 1000** e o **GID 1000** ser√£o os donos dos arquivos em `/usr/src/app`.

# 5. Melhorando a Seguran√ßa com ADD
Quando o `ADD` √© usado para baixar arquivos externos, ele pode introduzir riscos:

1. **Links N√£o Confi√°veis**:
   - Garanta que as URLs sejam seguras e autenticadas.
   - Evite downloads diretos que possam ser interceptados.

2. **Verifica√ß√£o de Integridade**:
   - Combine `ADD` com verifica√ß√£o de hashes para garantir a integridade do arquivo.

### Exemplo:

dockerfile
```
FROM ubuntu:20.04

ADD https://example.com/config.tar.gz /tmp/config.tar.gz

# Verificar o hash do arquivo
RUN echo "abc123  /tmp/config.tar.gz" | sha256sum -c -
```
# 6. Erros Comuns com ADD
1. **Usar `ADD` desnecessariamente**:
   - Use `COPY` para arquivos locais que n√£o precisam de extra√ß√£o ou download.

2. **Extrair arquivos n√£o desejados**:
   - Se n√£o precisar extrair arquivos compactados, prefira `COPY`.

3. **Falha ao excluir arquivos baixados**:
   - Sempre limpe arquivos tempor√°rios para reduzir o tamanho da imagem:

      dockerfile
      ```
      ADD file.tar.gz /tmp/
      RUN tar -xzvf /tmp/file.tar.gz -C /app && rm /tmp/file.tar.gz
      ```
# 7. Boas Pr√°ticas
1. **Prefira `COPY` para tarefas simples**:
   - `ADD` deve ser usado apenas para funcionalidades extras, como extra√ß√£o e download.

2. **Valide arquivos externos**:
   - Use verifica√ß√µes de hash para garantir que arquivos baixados n√£o foram corrompidos.

3. **Gerencie Permiss√µes**:
   - Utilize `--chown` para definir corretamente as permiss√µes dos arquivos copiados.

# 8. Conclus√£o
A instru√ß√£o `ADD` no Dockerfile √© √∫til em cen√°rios onde √© necess√°rio:
1. **Extrair arquivos compactados automaticamente**.
2. **Baixar arquivos de URLs externas diretamente**.

Apesar de sua flexibilidade, o uso indevido do `ADD` pode tornar as imagens maiores e mais complexas. Sempre prefira `COPY` para c√≥pias simples e use `ADD` apenas quando necess√°rio.

Se precisar de mais exemplos ou ajuda com a otimiza√ß√£o do seu Dockerfile, √© s√≥ chamar! üöÄ üòä
