# Storage tmpfs no Docker
O `tmpfs` **storage** √© um tipo de armazenamento tempor√°rio que utiliza a mem√≥ria do sistema host para armazenar dados. Ele √© √∫til para cen√°rios onde a performance √© mais importante que a persist√™ncia, j√° que os dados armazenados em `tmpfs` desaparecem assim que o cont√™iner √© interrompido ou removido.

# 1. O Que √© `tmpfs` Storage?
- O `tmpfs` (Temporary File System) √© um sistema de arquivos em mem√≥ria.
- No contexto do Docker, ele permite criar √°reas de armazenamento no cont√™iner que residem inteiramente na mem√≥ria do host.
- Os dados armazenados s√£o vol√°teis e n√£o sobrevivem a reinicializa√ß√µes ou interrup√ß√µes do cont√™iner.

# 2. Benef√≠cios do `tmpfs` Storage
1. **Alto Desempenho**:
- Como os dados est√£o na mem√≥ria, o acesso √© muito mais r√°pido do que armazenar em disco.

2. **Isolamento de Dados Sens√≠veis**:
- Ideal para armazenar informa√ß√µes sens√≠veis que n√£o precisam ser persistentes.

3. **Evita Escrita em Disco**:
- Reduz o desgaste de discos f√≠sicos ou SSDs.

4. **Armazenamento Tempor√°rio Limpo**:
- √ìtimo para dados tempor√°rios, como arquivos de cache ou logs intermedi√°rios.

# 3. Como Usar `tmpfs` no Docker
## 3.1 Usando `--tmpfs` no docker run
Voc√™ pode montar um sistema de arquivos `tmpfs` em qualquer caminho dentro do cont√™iner.

### Exemplo:

bash
```
docker run -it --rm --tmpfs /dados ubuntu
```
### Explica√ß√£o:
- `--tmpfs /dados`: Monta um sistema de arquivos `tmpfs` no caminho `/dados` dentro do cont√™iner.
- Os dados gravados em `/dados` ser√£o armazenados na mem√≥ria.

## 3.2 Usando `--mount` no `docker` run
O m√©todo `--mount` oferece mais controle sobre a configura√ß√£o.

### Exemplo:

bash
```
docker run -it --rm --mount type=tmpfs,destination=/dados,tmpfs-size=64m ubuntu
```
### Explica√ß√£o:
- `type=tmpfs`: Especifica que o tipo de montagem √© `tmpfs`.
- `destination=/dados`: Caminho dentro do cont√™iner onde o `tmpfs` ser√° montado.
- `tmpfs-size=64m`: Limita o tamanho do sistema de arquivos `tmpfs` a 64 MB.

## 3.3 Configurando com Docker Compose
Voc√™ tamb√©m pode configurar `tmpfs` em servi√ßos do Docker Compose.

### Exemplo de `docker-compose.yml`:

yaml
```
version: "3.9"
services:
  app:
    image: ubuntu
    command: sleep infinity
    tmpfs:
      - /dados:rw,noexec,size=64m
```
### Explica√ß√£o:
- `tmpfs`: Define os caminhos que ser√£o montados como tmpfs no cont√™iner.
- `rw,noexec,size=64m`: Configura√ß√µes adicionais:
  - `rw`: Modo leitura/escrita.
  - `noexec`: Impede execu√ß√£o de arquivos nesse sistema de arquivos.
  - `size=64m`: Limita o tamanho para 64 MB.

# 4. Casos de Uso do tmpfs
1. **Armazenamento Tempor√°rio**:
- Cache de aplica√ß√µes, arquivos de sess√£o ou dados intermedi√°rios que n√£o precisam ser salvos.

2. **Isolamento de Dados Sens√≠veis**:
- Dados confidenciais que n√£o devem ser escritos em disco.

3. **Logs Tempor√°rios**:
- Armazenar logs que n√£o precisam ser persistidos para an√°lise posterior.

4. **Melhoria de Desempenho**:
- Reduzir lat√™ncia ao evitar opera√ß√µes de escrita em disco.

# 5. Configura√ß√µes Avan√ßadas de tmpfs
O `tmpfs` suporta v√°rias op√ß√µes de configura√ß√£o, que podem ser usadas para ajustar seu comportamento.

## 5.1 Op√ß√µes Comuns
- `size=<tamanho>`: Limita o tamanho do sistema de arquivos.

bash
```
--mount type=tmpfs,destination=/dados,tmpfs-size=128m
```
- `rw` **ou** `ro`: Define o acesso como leitura/escrita ou somente leitura.

bash
```
--mount type=tmpfs,destination=/dados,tmpfs-size=128m,rw
```
- `noexec`: Impede execu√ß√£o de arquivos dentro do `tmpfs`.

bash
```
--mount type=tmpfs,destination=/dados,noexec
```
## 5.2 Limitar Tamanho do `tmpfs`
Limitar o tamanho do `tmpfs` √© importante para evitar que ele consuma toda a mem√≥ria do host.

Exemplo:

bash
```
docker run -it --rm --mount type=tmpfs,destination=/dados,tmpfs-size=256m ubuntu
```
# 6. Monitorando o Uso de `tmpfs`
Voc√™ pode verificar o uso de mem√≥ria e espa√ßo do `tmpfs` dentro do cont√™iner com o comando:

bash
```
df -h /dados
```
# 7. Compara√ß√£o com Outros M√©todos de Armazenamento
| Aspecto                | tmpfs                        | Volumes              | Bind Mounts            |
| ---------------------- | ---------------------------- | -------------------- | ---------------------- |
| Persist√™ncia           | Dados perdidos ao reiniciar. | Persistente.         | Depende do host.       |
| Desempenho             | Muito r√°pido (na mem√≥ria).   | Moderado (em disco). | Depende do host.       |
| Ideal para             | Dados tempor√°rios.           | Dados permanentes.   | Desenvolvimento local. |
| Gerenciado pelo Docker | Sim.                         | Sim.                 | N√£o.                   |

# 8. Exemplos Pr√°ticos
## 8.1 Cache Tempor√°rio
Monte um diret√≥rio tempor√°rio para armazenar cache durante a execu√ß√£o do cont√™iner:

bash
```
docker run -it --rm --mount type=tmpfs,destination=/cache,tmpfs-size=128m ubuntu
```
Dentro do cont√™iner:

bash
```
echo "Cache tempor√°rio" > /cache/arquivo.txt
```
## 8.2 Logs Tempor√°rios
Armazene logs em mem√≥ria para evitar grava√ß√£o em disco:

bash
```
docker run -it --rm --mount type=tmpfs,destination=/var/log,tmpfs-size=64m nginx
```
# 9. Boas Pr√°ticas ao Usar tmpfs
1. **Limite o Tamanho**:
- Sempre defina um tamanho m√°ximo para evitar que o `tmpfs` consuma toda a mem√≥ria do host.

2. **Use para Dados Tempor√°rios**:
- N√£o armazene dados que precisam ser persistidos.

3. **Combine com Restri√ß√µes de Acesso**:
- Use op√ß√µes como `noexec` e `ro` para proteger dados sens√≠veis.

4. **Monitore o Uso de Mem√≥ria**:
- Verifique regularmente o uso de mem√≥ria do cont√™iner.

# 10. Conclus√£o
O `tmpfs` **storage** √© uma excelente op√ß√£o para armazenar dados tempor√°rios em mem√≥ria, oferecendo alto desempenho e maior controle sobre dados sens√≠veis. Ele deve ser usado em cen√°rios onde a persist√™ncia n√£o √© necess√°ria, e a performance √© prioridade.

## Resumo:
- **Comando B√°sico**:

bash
```
docker run -it --rm --tmpfs /dados ubuntu
```
- **Com Controle Avan√ßado**:

bash
```
docker run -it --rm --mount type=tmpfs,destination=/dados,tmpfs-size=64m ubuntu
```
- **Ideal Para**: Cache, logs tempor√°rios e dados transit√≥rios.

Se precisar de ajuda para configurar ou usar tmpfs no Docker, √© s√≥ chamar! üöÄüòä